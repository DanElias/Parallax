{"changed":false,"filter":false,"title":"_conection_queries_db.php","tooltip":"/Proyecto/Website/basesdedatos/_conection_queries_db.php","value":"<?php\n\n//se conecta con la base de datos indicada\nfunction conectDb()\n{//¿Estos parámetros deben de cambiar cuando la págn se suba a otro servidor que no sea tu propia pc?\n    $servername = \"localhost\";\n    $username = \"root\";\n    $password = \"\";\n    $dbname = \"proyecto\";\n\n    @$con = new mysqli($servername, $username, $password, $dbname);\n\n    if($con->connect_error){\n      //die(\"No se ha podido establecer una conexión con la base de datos. \" . $con->connection_error);\n      //include(\"error_server_card.html\");\n      //echo \"<script>alert('No hemos podido establecer una conexión con la base de datos. Asegúrate de estar conectado a Internet o vuelve a intentarlo más tarde');</script>\";\n      alertaNoHayConexion();\n      include(\"../views/_footer_admin.html\");\n      die();\n    }\n    $con->set_charset(\"utf8\");\n    return $con;\n}\n\n//cierra la conexión con la base de datos\nfunction closeDb($mysql)\n{\n    $mysql->close();\n}\n\nfunction obtenerRoles(){\n    $con = conectDb();\n    $query=\"SELECT * FROM rol ORDER BY descripcion ASC\";\n    $result=$con->query($query);\n    $salida='<option value=\"0\">Elige un rol</option>';\n    //PARA PODER GUARDAR SE OCUPA UN VALOR QUE EN ESTE CASO SERÍA EL ID DEL INCIDENTE\n    while($row=  mysqli_fetch_array($result,MYSQLI_BOTH)){\n        $salida.=\"<option value='$row[id_rol]'>$row[descripcion]</option>\";\n    }\n    return  $salida;\n}\nfunction eliminarUsuarioPorID($id_usuario)\n{\n\n    $conn = conectDb();\n    $sql = \"DELETE FROM usuario WHERE id_usuario = ?\";\n    if($stmt = $conn->prepare($sql)){\n        $stmt->bind_param('i', $id_usuario);\n        $stmt->execute();\n        $result = $stmt->get_result();\n        $stmt->close();\n        closeDB($conn);\n        return true;\n    } else{\n        closeDB($conn);\n        return false;\n    }\n    closeDB($conn);\n}\n\n//obtiene todas las tuplas con todos sus datos\nfunction obtenerEventos()\n{\n    $conn = conectDb();\n    $sql = \"SELECT id_evento, nombre, fecha, hora, lugar, descripcion, imagen FROM evento\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n// regresa todos los datos de una tupla cuyo nombre sea igual al especificado\nfunction obtenerEventosPorNombre($nombre_evento)\n{\n    /*$conn = conectDb();\n\n    $sql = \"SELECT id_evento, nombre, fecha, hora, lugar, descripcion, imagen FROM evento WHERE nombre LIKE '%\" . $nombre_evento . \"%'\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT id_evento, nombre, fecha, hora, lugar, descripcion, imagen FROM evento WHERE nombre LIKE '%?%'\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('s',$nombre_evento);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n\n}\n\n// regresa todos los datos de una tupla cuyo fecha ocurra antes o igual a una fecha especificada.\nfunction obtenerEventosPorFecha($fecha_evento)\n{//Las fechas se guardan como 1998-03-28\n    /*$conn = conectDb();\n\n    $sql = \"SELECT id_evento, nombre, fecha, hora, lugar, descripcion, imagen FROM evento WHERE fecha LIKE '%\" . $fecha_evento . \"%'\";\n\n    echo $sql;\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT id_evento, nombre, fecha, hora, lugar, descripcion, imagen FROM evento WHERE fecha LIKE '%?%'\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('s',$fecha_evento);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\nfunction obtenerEventosPorID($id_evento)\n{\n    /*$conn = conectDb();\n\n    $sql = \"SELECT id_evento, nombre, fecha, hora, lugar, descripcion, imagen FROM evento WHERE id_evento = '\" . $id_evento . \"'\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;\n    */\n    $conn = conectDb();\n    $sql = \"SELECT id_evento, nombre, fecha, hora, lugar, descripcion, imagen FROM evento WHERE id_evento = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('i',$id_evento);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\nfunction obtenerEventoReciente()\n{\n\n    /*$conn = conectDb();\n\n    $sql = \"SELECT id_evento FROM evento ORDER BY id_evento DESC LIMIT 1\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT id_evento FROM evento ORDER BY id_evento DESC LIMIT 1\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n//Inserta un nuevo evento en la base de datos\nfunction insertarEvento($nombre_evento, $fecha_evento, $hora_evento, $lugar_evento, $descripcion_evento, $imagen_evento)\n{\n    /*$conn = conectDb();\n\n\n    //INSERT INTO evento VALUES (,'Venta de Garage' ,'2019-03-28', '16:30:00','Mariana Sala I.A.P.' ,'Vamos a vender mobiliario para obtener fondos.', '../eventos/uploads/f3.jpg')\n\n    $sql = \"INSERT INTO evento (id_evento, nombre, fecha, hora, lugar, descripcion, imagen) VALUES\n        (0,\\\"\" . $nombre_evento . \"\\\",\\\"\" . $fecha_evento . \"\\\",\\\"\" . $hora_evento . \"\\\",\\\"\" . $lugar_evento . \"\\\",\\\"\" . $descripcion_evento . \"\\\",\\\"\" . $imagen_evento . \"\\\")\";\n\n    if (mysqli_query($conn, $sql)) {\n        closeDb($conn);\n        return true;\n    } else {\n        closeDb($conn);\n        return false;\n    }*/\n    $conn = conectDb();\n    $sql = \"INSERT INTO evento (nombre, fecha, hora, lugar, descripcion, imagen) VALUES (?,?,?,?,?,?)\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('ssssss',$nombre_evento, $fecha_evento, $hora_evento, $lugar_evento, $descripcion_evento, $imagen_evento);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n\n}\n\n//Inserta un nuevo evento en la base de datos\nfunction editarEvento($id_evento, $nombre_evento, $fecha_evento, $hora_evento, $lugar_evento, $descripcion_evento, $imagen_evento)\n{\n    /*$conn = conectDb();\n\n    $sql = \"UPDATE evento SET id_evento=$id_evento, nombre='\" . $nombre_evento . \"', fecha='\" . $fecha_evento . \"', hora='\" . $hora_evento . \"', lugar='\" . $lugar_evento . \"', descripcion='\" . $descripcion_evento . \"', imagen='\" . $imagen_evento . \"'\n        WHERE id_evento=\" . $id_evento . \"\";\n\n    if (mysqli_query($conn, $sql)) {\n        closeDb($conn);\n        return true;\n    } else {\n        closeDb($conn);\n        return false;\n    }*/\n    $conn = conectDb();\n    $sql = \"UPDATE evento SET id_evento=?, nombre=?, fecha=?, hora=?, lugar=?, descripcion=?, imagen=? WHERE id_evento=?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('issssssi',$id_evento, $nombre_evento, $fecha_evento, $hora_evento, $lugar_evento, $descripcion_evento, $imagen_evento, $id_evento);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n\n}\n\n//borra el evento que tenga el id\nfunction eliminarEventoPorID($id_evento)\n{\n    /*$conn = conectDb();\n\n    $sql = \"DELETE FROM evento WHERE id_evento ='\" . $id_evento . \"'\";\n\n    if (mysqli_query($conn, $sql)) {\n        closeDb($conn);\n        return true;\n    } else {\n        closeDb($conn);\n        return false;\n    }*/\n\n    $conn = conectDb();\n    $sql = \"DELETE FROM evento WHERE id_evento = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('i',$id_evento);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n}\n\n\nfunction registrar_usuario($usuario, $nombre, $apellido, $password, $fecha_nacimiento, $id_rol)\n{\n    /*$conn = conectDb();\n\n    //Query de SQl para insertar en la tabla de usaurios\n    $sql = \"INSERT INTO usuario(email, nombre, apellido, passwd, fecha_nacimiento, fecha_creacion, id_rol) VALUES (\\\"\" . $usuario . \"\\\",\\\"\" . $nombre . \"\\\",\\\"\" . $apellido . \"\\\",\\\"\" . $password . \"\\\",\\\"\" . $fecha_nacimiento . \"\\\",\\\"\" . $fecha_creacion . \"\\\",\\\"\" . $id_rol . \"\\\")\";\n\n    if (mysqli_query($conn, $sql)) {\n        closeDb($conn);\n        return true;\n    } else {\n        closeDb($conn);\n        return false;\n    }*/\n    $conn = conectDb();\n    $sql = \"INSERT INTO usuario(email, nombre, apellido, passwd, fecha_nacimiento, id_rol) VALUES (?,?,?,?,?,?)\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('sssssi',$usuario, $nombre, $apellido, $password, $fecha_nacimiento, $id_rol);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n}\n\nfunction registrar_Rol($nombre)\n{\n    /*\n    $conn = conectDb();\n\n    //Query de SQl para insertar en la tabla de usaurios\n    $sql = \"INSERT INTO rol (descripcion) VALUES ($nombre)\";\n\n    if (mysqli_query($conn, $sql)) {\n        closeDb($conn);\n        return true;\n    } else {\n        closeDb($conn);\n        echo 'Error: '. mysqli_error($conn);\n        return false;\n    }\n    */\n\n    $conn = conectDb();\n    $sql = \"INSERT INTO rol (descripcion) VALUES (?)\";\n    if($stmt = $conn->prepare($sql)){\n        $stmt->bind_param('s',$nombre);\n        $stmt->execute();\n        $result = $stmt->get_result();\n        $stmt->close();\n        closeDB($conn);\n        return true;\n    } else{\n        closeDB($conn);\n        echo mysqli_error($sql);\n        return false;\n    }\n    closeDB($conn);\n\n}\n\n\n/******    CONSULTAS PROVEEDOR       *****/\nfunction obtenerProveedor()\n{\n\n    /*$conn = conectDb();\n\n    $sql = \"SELECT rfc, alias, telefono_contacto, cuenta_bancaria FROM proveedor\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT rfc, alias, razon_social, nombre_contacto, telefono_contacto, cuenta_bancaria, banco  FROM proveedor\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\nfunction obtener_proveedor_id($rfc){\n\n    $conn = conectDb();\n    $sql = \"SELECT rfc, alias, razon_social, nombre_contacto, telefono_contacto, cuenta_bancaria, banco FROM proveedor WHERE rfc = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('s', $rfc);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\nfunction registrar_proveedor($rfc, $alias, $razon, $nombre, $telefono, $cuenta, $banco)\n{\n    /*$conn = conectDb();\n    //$sql = \"INSERT INTO Proveedor(rfc,alias,razon_social,nombre_contacto,telefono_contacto,cuenta_bancaria, banco) VALUES (\\\"\".$rfc.\"\\\",\\\"\".$alias.\"\\\",\\\"\".$razon.\"\\\",\\\"\".$nombre.\"\\\",\\\"\".$telefono.\"\\\",\\\"\".$cuenta.\"\\\",\\\"\".$banco.\"\\\")\";\n    //Query de SQl para insertar en la tabla de proveedores\n    $sql = \"INSERT INTO Proveedor(rfc,alias,razon_social,nombre_contacto,telefono_contacto,cuenta_bancaria, banco)\n                VALUES ('$rfc', '$alias','$razon', '$nombre', '$telefono', '$cuenta', '$banco')\";\n\n\n    //'$rfc','$alias','$razon','$nombre','$telefono','$cuenta','$banco''\n\n    if (mysqli_query($conn, $sql)) {\n        closeDb($conn);\n        return true;\n    } else {\n        closeDb($conn);\n        return false;\n    }*/\n    $conn = conectDb();\n    $sql = \"INSERT INTO Proveedor(rfc,alias,razon_social,nombre_contacto,telefono_contacto,cuenta_bancaria, banco) VALUES (?,?,?,?,?,?,?)\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('sssssss',$rfc, $alias, $razon, $nombre, $telefono, $cuenta, $banco);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n\n}\n\n\n\nfunction editar_proveedor($rfc_actual,$rfc_anterior, $alias, $razon, $nombre, $telefono, $cuenta, $banco){\n\t$conn = conectDb();\n    $sql = \"UPDATE proveedor SET rfc=?, alias=?, razon_social=?, nombre_contacto=?, telefono_contacto=?, cuenta_bancaria=?, banco=? WHERE rfc=?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('ssssssss',$rfc_actual, $alias, $razon, $nombre, $telefono, $cuenta, $banco, $rfc_anterior);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n}\n\nfunction eliminar_proveedor_id($rfc)\n{\n\n    $conn = conectDb();\n\n    $sql = \"DELETE FROM proveedor WHERE rfc = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('s',$rfc);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    }else{\n\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n}\n\n/**************************/\n\n\nfunction registrar_cuenta_contable($nombre_cuenta, $descripcion_cuenta)\n{\n    /*$conn = conectDb();\n\n    //Query de SQl para insertar en la tabla de cuenta contable\n    $sql = \"INSERT INTO cuenta_contable(nombre, descripcion) VALUES (\\\"\" . $nombre_cuenta . \"\\\",\\\"\" . $descripcion_cuenta . \"\\\")\";\n\n    if (mysqli_query($conn, $sql)) {\n        closeDb($conn);\n        return true;\n    } else {\n        closeDb($conn);\n        return false;\n    }*/\n    $conn = conectDb();\n    $sql = \"INSERT INTO cuenta_contable(nombre, descripcion) VALUES (?,?)\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('ss',$nombre_cuenta, $descripcion_cuenta);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n}\n\nfunction obtener_cuenta_contable_reciente()\n{\n    $conn = conectDb();\n    $sql = \"SELECT id_cuentacontable FROM cuenta_contable ORDER BY id_cuentacontable DESC LIMIT 1\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\nfunction obtener_usuario_reciente()\n{\n    $conn = conectDb();\n    $sql = \"SELECT id_usuario FROM usuario ORDER BY id_usuario DESC LIMIT 1\";\n    if($stmt = $conn->prepare($sql)){\n        $stmt->execute();\n        $result = $stmt->get_result();\n        $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\nfunction obtenerCuentaPorID($id_cuentacontable)\n{\n    $conn = conectDb();\n    $sql = \"SELECT id_cuentacontable,nombre,descripcion FROM cuenta_contable WHERE id_cuentacontable = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('i',$id_cuentacontable);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\nfunction obtenerIdCuentaDelEgreso($id_cuentacontable)\n{\n    $conn = conectDb();\n    $sql = \"SELECT id_cuentacontable FROM egreso WHERE id_cuentacontable = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('i',$id_cuentacontable);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\nfunction obtenerUsuariosPorID($id_usuario){\n\n    /*$conn = conectDb();\n\n    $sql = \"SELECT id_evento FROM usuario WHERE id_usuario = '\".$id_usuario.\"'\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT id_usuario,nombre,apellido,email,fecha_nacimiento,id_rol FROM usuario WHERE id_usuario = ?\";\n    if($stmt = $conn->prepare($sql)){\n        $stmt->bind_param('i', $id_usuario);\n        $stmt->execute();\n        $result = $stmt->get_result();\n        $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\n\n\nfunction editarCuenta($id_cuentacontable, $nombre, $descripcion)\n{\n    $conn = conectDb();\n    $sql = \"UPDATE cuenta_contable SET id_cuentacontable=?, nombre=?, descripcion=?  WHERE id_cuentacontable=?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('issi', $id_cuentacontable, $nombre, $descripcion, $id_cuentacontable);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n\n}\nfunction editarUsuario($id_usuario, $nombre,$apellido,$email,$password,$fecha_nacimiento,$rol)\n{\n\n    $conn = conectDb();\n    $sql = \"UPDATE `usuario` SET `email` = '\".$email.\"', `nombre` = '\".$nombre.\"', `apellido` = '\".$apellido.\"', `passwd` = '\".$password.\"', `fecha_nacimiento` = '\".$fecha_nacimiento.\"', `id_rol` = '\".$rol.\"' WHERE `usuario`.`id_usuario` = '\".$id_usuario.\"'\";\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n    return $result;\n    /*\n    $conn = conectDb();\n    $sql = \"UPDATE usuario SET id_usuario=?, nombre=? ,apellido=?,email=?,passw=?,fecha_nacimeint=?,id_rol=? WHERE id_usuario=?\";\n    if($stmt = $conn->prepare($sql)){\n        $stmt->bind_param('isssssi', $id_ususario, $nombre,$apellido,$email,$password,$fecha_nacimiento,$rol);\n        $stmt->execute();\n        $result = $stmt->get_result();\n        $stmt->close();\n        closeDB($conn);\n        return true;\n    } else{\n        closeDB($conn);\n        return false;\n    }\n    closeDB($conn);\n*/\n}\n\n\nfunction eliminarCuentaPorID($id_cuentacontable)\n{\n\n    $conn = conectDb();\n    $sql = \"DELETE FROM cuenta_contable WHERE id_cuentacontable = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('i', $id_cuentacontable);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n}\n\n\n\n\nfunction autentificarse($email, $password)\n{\n    /*$con = conectDb();\n\n    //$sql = \"SELECT email,passwd FROM usuario WHERE email = '$email' And passwd = '$password'\";\n    $sql = \"SELECT passwd FROM usuario WHERE email = '$email'\";\n\n    $result = mysqli_query($con, $sql);*/\n    $conn = conectDb();\n    $sql = \"SELECT passwd FROM usuario WHERE email = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('s',$email);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n    }\n    $row = mysqli_fetch_assoc($result);\n    $contra = password_verify($password, $row['passwd']);\n    return $contra;\n\n\n}\n\n/*\n*Esta funcion dependiendo del email y el password regresara el nombre del usuario\n*/\nfunction login($email, $password)\n{\n\n\n    /*// SELECT nombre FROM login WHERE email = 'josecarlos@gmail.com' And password = '123'\n    $con = conectDb();\n    $sql = \"SELECT nombre,id_rol FROM usuario WHERE email = '$email'\";\n    $result = mysqli_query($con, $sql);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT nombre,id_rol FROM usuario WHERE email = ?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('s',$email);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\nfunction obtenerUsuario()\n{\n\n    /*$conn = conectDb();\n\n    $sql = \"SELECT id_usuario, nombre, email, fecha_creacion,id_rol FROM usuario\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT id_usuario, nombre,apellido, email, fecha_creacion,descripcion FROM usuario,rol WHERE rol.id_rol = usuario.id_rol\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\nfunction obtenerEgresos()\n{\n\n    /*$conn = conectDb();\n\n    $sql = \"SELECT folio_factura, fecha,importe,cuenta_bancaria FROM egreso\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT folio_factura, concepto, importe, fecha ,cuenta_bancaria, observaciones, rfc, id_cuentacontable FROM egreso\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\nfunction obtenerCuentas()\n{\n\n    /*$conn = conectDb();\n\n    $sql = \"SELECT id_cuentacontable, nombre,descripcion FROM cuenta_contable\";\n\n    $result = mysqli_query($conn, $sql);\n\n    closeDb($conn);\n\n    return $result;*/\n    $conn = conectDb();\n    $sql = \"SELECT id_cuentacontable, nombre,descripcion FROM cuenta_contable\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n}\n\n\n  function insertarTutor($nombre, $apellido, $telefono, $fecha, $ocupacion, $empresa, $grado, $titulo){\n    $conn = conectDb();\n    $sql = \"INSERT INTO tutor(nombre, apellido, telefono, fecha_nacimiento, ocupacion, nombre_empresa, grado_estudio, titulo_obtenido) VALUES (?,?,?,?,?,?,?,?)\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('ssssssss',$nombre,$apellido,$telefono,$fecha,$ocupacion,$empresa,$grado,$titulo);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n      closeDB($conn);\n      return true;\n    } else{\n      closeDB($conn);\n      return false;\n    }\n    closeDB($conn);\n  }\n\n  function getNombreTutor(){\n    $conn = conectDb();\n    $sql = \"SELECT id_tutor,nombre,apellido FROM tutor\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n  }\n\n  function getNombreBeneficiarios(){\n    $conn = conectDb();\n    $sql = \"SELECT id_beneficiario,nombre,apellido,fecha_nacimiento,grupo,estado FROM beneficiario\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n  }\n\n  function getBeneficiariosActivos(){\n    $conn = conectDb();\n    $sql = \"SELECT * FROM beneficiario WHERE estado=1\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n  }\n\n  function getInfoBeneficiarios(){\n    $conn = conectDb();\n    $sql = \"SELECT * FROM beneficiario\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n  }\n\n  function getEstadoById($id){\n    $conn = conectDb();\n    $sql = \"SELECT estado FROM beneficiario WHERE id_beneficiario=?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('i',$id);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    if ($result->num_rows > 0){\n      while($row = $result->fetch_assoc()) {\n          $estado = $row['estado'];\n      }\n    } else{\n      $estado = -1;\n    }\n    return $estado;\n  }\n\n  function modificarEstado($id,$estado){\n    $conn = conectDb();\n    $sql = \"UPDATE beneficiario SET estado=? WHERE id_beneficiario=?\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->bind_param('ii',$estado,$id);\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n  }\n\n  function getInfoTutores(){\n    $conn = conectDb();\n    $sql = \"SELECT * FROM tutor\";\n    if($stmt = $conn->prepare($sql)){\n      $stmt->execute();\n      $result = $stmt->get_result();\n      $stmt->close();\n    }\n    closeDB($conn);\n    return $result;\n  }\n\n\n  function alertaNoHayConexion(){\n    $alerta='\n    <script>M.AutoInit();</script>\n    <div id=\"_form_alerta_error\" class=\"modal  my_modal\">\n        <div class=\"row my_modal_header_row\">\n            <div class=\"my_modal_header_eliminar z-depth-2 col s12\">\n                <h4 class=\"my_modal_header\">Lo sentimos</h4>\n            </div>\n        </div>\n        <br><br>\n        <div class=\"modal-content my_modal_content\">\n            <br><br>\n            <h5 class=\"my_modal_description2\"></h5>\n            <div class=\"row\">\n                <div class=\"col s12\">\n                        <h5>\n                          Lo sentimos, no hay conexión con la base de datos. Asegúrate de estar conectado a internet o contacta al administrador.\n                          <br><br> (Error 505)\n                        <h5>\n                </div>\n            <div>\n            <br>\n            <br>\n\n            <div class=\"my_modal_buttons\">\n                <div class=\"row\">\n\n                    <div class=\"col s12 m12\">\n                        <button class=\"modal-close btn waves-effect waves-light modal-close\">Ok, estoy enterado.\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>';\n\n\n    $alerta.= \"<script type='text/javascript'>\n            $(document).ready(function(){\n                  $('#_form_alerta_error').modal();\n                  $(document).ready(function(){\n                      $('#_form_alerta_error').modal('open');\n                  });\n            });\n    </script>\";\n\n    echo $alerta;\n\n  }\n\n?>\n","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":10973.5625,"scrollleft":0,"selection":{"start":{"row":774,"column":11},"end":{"row":774,"column":15},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":759,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1555734607238}